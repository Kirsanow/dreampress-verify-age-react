!function(){"use strict";const e="uvae-token";const t=new class{constructor(){this._jwk={alg:"PS256",e:"AQAB",kty:"RSA",n:"oZcuAKQFI3jGMXr6hjGyshDYD-msQuvuMm6ytVYbKci9pwIpEAyErulo_KcYR3jQkX-BDkTF-3bxKuIRfIe1fAyOTDyQIvIpvJfymmSudL-Uu0eOTb3GEkewPRVBo1jyKu5q3HY0bAX8lPCsXJ0X3QJfb6COhm1rOJcMUmv18ryZgauvQ18w9ZmP4yPtqW4jh4jLuPoHaFex_zHO9T6a1fDDnx1rk1ircHkVii8DViAkFf9O65SasZOcXkWuVrjWIivGMHg_lVwxwksmNqPa6pBdmdfAhljF63hYeP7ska1RuDCwaWNNVcqq1LFyUEV7Hdf88lQeozCi6Z8Cv7l1qQ",use:"sig"}}async estimateAge(t={}){const r=localStorage.getItem(e);if(r)if(t.enableCache)try{let t=await this.verifyToken(r);if(t)return t.age;localStorage.removeItem(e)}catch(t){localStorage.removeItem(e)}else localStorage.removeItem(e);return new Promise((async(r,n)=>{let i=!1;const a=Math.random().toString(36).substring(2,15),o=t.localTesting?"../index.html":"https://universal-verify.github.io/age-estimator/",s=t.localTesting?window.location.origin:"https://universal-verify.github.io",c=t.livenessCheck||!1,l=t.cacheDuration||864e5,d=window.open(o,"_blank");if(!d)return void n("POPUP_BLOCKED");function cleanup(){window.removeEventListener("message",handler),clearInterval(h)}const handler=async o=>{if(o.source===d&&o.origin===s)if("age-estimation-result"===o.data.type){if(o.data.nonce!==a)return;i=!0;try{await this.verifyToken(o.data.token)?(t.enableCache&&localStorage.setItem(e,o.data.token),r(o.data.age)):n("INVALID_SIGNATURE")}catch(e){n("INVALID_SIGNATURE")}d.close(),cleanup()}else if("age-estimation-error"===o.data.type){if(o.data.nonce!==a)return;i=!0,o.data.error.includes("webcam")?n("WEBCAM_ERROR"):o.data.error.includes("Different face")?n("DIFFERENT_FACE_ERROR"):n("INTERNAL_ERROR"),d.close(),cleanup()}else if("check-parent-commandeer"===o.data.type){let e=window.location.origin;d.postMessage({type:"confirm-parent-commandeer",nonce:a,livenessCheck:c,cacheDuration:l,origin:e},e)}};window.addEventListener("message",handler);const h=setInterval((()=>{d.closed&&!i&&(i=!0,n("CANCELLED"),cleanup())}),500)}))}clearCache(){localStorage.removeItem(e)}async getCachedAge(){const t=localStorage.getItem(e);if(t)try{let r=await this.verifyToken(t);if(r)return r.age;localStorage.removeItem(e)}catch(t){localStorage.removeItem(e)}return null}getCachedToken(){return localStorage.getItem(e)||null}async verifyToken(e){const t=await crypto.subtle.importKey("jwk",this._jwk,{name:"RSA-PSS",hash:"SHA-256"},!1,["verify"]),[r,n]=e.split("."),i=JSON.parse(atob(r));if(i.exp<Date.now())throw new Error("EXPIRED");if(i.sub!==function(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}(navigator.userAgent+window.location.origin))throw new Error("INVALID_SUB");if(!await crypto.subtle.verify({name:"RSA-PSS",saltLength:32},t,function(e){const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t.buffer}(n),(new TextEncoder).encode(r)))throw new Error("INVALID_SIGNATURE");return i}};new class{constructor(){this.setConfig(),this.hasValidToken().then((e=>{e||this.setupAgeGate()})).catch((e=>{console.error(e)}))}setConfig(){let e=window.uvaeConfig||{};this._cacheDuration=e.cacheDuration||864e5,this._minAge=Number.isInteger(e.minAge)?e.minAge:18,this._primaryColor=e.primaryColor||"#2463eb",this._zIndex=e.zIndex||"9999999"}async hasValidToken(){const e=t.getCachedToken();if(!e)return!1;try{const r=await t.verifyToken(e);return!(!r||!Number.isInteger(r.age)||r.age<this._minAge)||(t.clearCache(),!1)}catch(e){return t.clearCache(),!1}}setupAgeGate(){this._ageGate=document.createElement("div"),Object.assign(this._ageGate.style,{position:"fixed",inset:"0",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(12px)",zIndex:this._zIndex,display:"flex",alignItems:"center",justifyContent:"center"});const e=document.createElement("div");Object.assign(e.style,{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(16px)",borderRadius:"12px",padding:"32px",maxWidth:"448px",width:"100%",margin:"0 16px",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"});const t=document.createElement("div");t.style.textAlign="center";const r=document.createElement("div");r.innerHTML='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet" xmlns:bx="https://boxy-svg.com"><defs><bx:export><bx:file format="svg" href="#object-0" units="pt"/><bx:file format="svg" path="Untitled 2.svg" units="pt"/></bx:export></defs><ellipse style="stroke: rgb(0, 0, 0); fill: rgb(255, 255, 255);" cx="256.478" cy="242.4" rx="206.689" ry="215.167"/><g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none" id="object-0"><path d="M2435 5076 c-156 -61 -1935 -820 -1972 -841 -106 -63 -211 -188 -261 -313 -27 -67 -27 -69 -26 -312 0 -193 5 -280 22 -410 133 -994 517 -1825 1127 -2435 263 -263 577 -491 904 -654 241 -121 421 -121 662 0 413 207 814 523 1108 875 493 588 808 1343 922 2209 18 134 23 222 23 415 1 244 1 245 -26 312 -50 125 -155 250 -261 313 -40 23 -1936 830 -2006 854 -56 18 -149 13 -216 -13z m1060 -1034 l820 -348 -2 -125 c-3 -146 -25 -340 -59 -529 -176 -956 -661 -1736 -1366 -2197 -93 -60 -308 -183 -322 -183 -3 0 -6 850 -6 1890 l0 1889 58 -24 c31 -14 426 -182 877 -373z m-2145 -1332 c5 -504 5 -505 28 -553 46 -92 133 -137 267 -137 176 0 269 73 295 231 6 37 10 253 10 517 l0 452 140 0 140 0 0 -482 c-1 -532 -5 -590 -59 -703 -54 -117 -152 -198 -291 -240 -34 -10 -107 -19 -190 -22 -344 -14 -531 97 -607 362 -15 52 -17 125 -21 573 l-3 513 143 -3 143 -3 5 -505z" style="fill: rgb(36, 99, 235);"/><path d="M2722 3197 c2 -7 109 -327 238 -710 l235 -697 169 2 169 3 238 708 238 707 -142 0 -143 0 -170 -527 c-119 -372 -174 -529 -184 -531 -12 -2 -23 21 -44 85 -15 48 -93 287 -172 531 l-145 442 -145 0 c-115 0 -145 -3 -142 -13z" style="fill: rgb(36, 99, 235);"/></g></svg>',Object.assign(r.style,{width:"48px",height:"48px",margin:"0 auto 1rem auto",display:"block",overflow:"hidden"});const n=r.querySelector("svg");Object.assign(n.style,{width:"100%",height:"100%",display:"block"});r.querySelectorAll("path").forEach((e=>{e.style.fill=this._primaryColor}));const i=document.createElement("h2");i.style.cssText="font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 1rem;",i.textContent="Age Verification Required",this._description=document.createElement("p"),this._description.style.cssText="color: #d1d5db; margin-bottom: 1.5rem;",this._description.textContent="Please verify your age using our age estimator.";const a=document.createElement("button");Object.assign(a.style,{backgroundColor:this._primaryColor,color:"white",padding:"12px 24px",borderRadius:"8px",width:"100%",border:"none",cursor:"pointer",transition:"background-color 0.2s"}),a.textContent="Verify Age",a.onmouseover=()=>a.style.backgroundColor=function(e,t){const r=e.replace("#",""),n=parseInt(r.substr(0,2),16),i=parseInt(r.substr(2,2),16),a=parseInt(r.substr(4,2),16),adjust=e=>Math.max(0,Math.min(255,e+t)).toString(16).padStart(2,"0");return`#${adjust(n)}${adjust(i)}${adjust(a)}`}(this._primaryColor,-20),a.onmouseout=()=>a.style.backgroundColor=this._primaryColor,t.appendChild(r),t.appendChild(i),t.appendChild(this._description),t.appendChild(a),e.appendChild(t),this._ageGate.appendChild(e),document.documentElement.appendChild(this._ageGate),this._successOverlay=document.createElement("div"),Object.assign(this._successOverlay.style,{position:"fixed",inset:"0",zIndex:this._zIndex,display:"none",alignItems:"center",justifyContent:"center"});const o=document.createElement("div");Object.assign(o.style,{backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(24px)",borderRadius:"12px",padding:"32px",maxWidth:"448px",width:"100%",margin:"0 16px",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",textAlign:"center"});const s=document.createElement("div");s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>',Object.assign(s.style,{color:"#10B981",marginBottom:"1rem",width:"36px",height:"36px",margin:"0 auto 1rem auto"});const c=document.createElement("h2");Object.assign(c.style,{fontSize:"1.5rem",fontWeight:"700",color:"white",marginBottom:"1rem"}),c.textContent="Age Verified";const l=document.createElement("p");Object.assign(l.style,{color:"#d1d5db"}),l.textContent="Thank you for verifying your age.",o.appendChild(s),o.appendChild(c),o.appendChild(l),this._successOverlay.appendChild(o),document.documentElement.appendChild(this._successOverlay),a.addEventListener("click",(()=>this._handleVerifyClick())),this._observer&&this._observer.disconnect(),this._observer=new MutationObserver((async e=>{e.forEach((async e=>{if(e.removedNodes.forEach((async e=>{if(e===this._ageGate){await this.hasValidToken()||this.setupAgeGate()}})),"attributes"===e.type&&e.target===this._ageGate){await this.hasValidToken()||this.setupAgeGate()}}))})),this._observer.observe(this._ageGate.parentElement,{childList:!0}),this._observer.observe(this._ageGate,{attributes:!0,attributeFilter:["style","class"]})}async _handleVerifyClick(){try{await t.estimateAge({enableCache:!0,cacheDuration:this._cacheDuration,livenessCheck:!0,localTesting:window.location.origin.includes("localhost")})<this._minAge?(t.clearCache(),this._description.textContent="Your age estimate did not meet the minimum age requirement."):(this._successOverlay.style.display="flex",this._ageGate.style.display="none",setTimeout((()=>{this._successOverlay.style.display="none"}),3e3))}catch(e){this._description.textContent="DIFFERENT_FACE_ERROR"===e?"Different face detected during liveness check. Please try again.":"WEBCAM_ERROR"===e?"Unable to access your webcam. Please ensure you have granted camera permissions.":"POPUP_BLOCKED"===e?"Popup was blocked. Please allow popups for this site and try again.":"CANCELLED"===e?"Age verification was cancelled. Please try again.":"An error occurred while verifying your age. Please try again."}}}}();
